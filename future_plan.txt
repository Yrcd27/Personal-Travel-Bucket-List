ğŸš€ Complete CI/CD Pipeline Implementation Plan
ğŸ“Š Current State
âœ… Completed:

Jenkins server created: 34.202.19.207:8080
App server running: 23.20.92.144 (frontend: 5173, backend: 5000)
Jenkins installed and configured with plugins
Docker Hub credentials added (ID: dockerhub-credentials)
EC2 SSH key added (ID: ec2-ssh-key)
Pipeline job created: travel-bucket-list-pipeline
ğŸ¯ Final Goal
GitHub Push â†’ Automatic Build â†’ Docker Hub Push â†’ EC2 Deploy â†’ Live Application

ğŸ“ Critical Information (Save This!)
Repository & Credentials
GitHub Repo: https://github.com/[YOUR_USERNAME]/Personal-Travel-Bucket-List
Docker Hub User: yrcd27
Docker Hub Repo: yrcd27/travel-bucket-list
Jenkins Credentials IDs:
  - dockerhub-credentials (Username: yrcd27, Password: [YOUR_TOKEN])
  - ec2-ssh-key (Username: ubuntu, Private Key: travel-bucket-key.pem)

EC2 Servers:
  App Server: 23.20.92.144
  Jenkins Server: 34.202.19.207
  
Docker Images:
  Frontend: yrcd27/travel-bucket-list-frontend:latest
  Backend: yrcd27/travel-bucket-list-backend:latest

ğŸ”§ Step 1: Update Jenkinsfile with Deploy Stage
Location: Jenkinsfile

Add AFTER the "Push to Docker Hub" stage (before closing stages block):
        stage('Deploy to EC2') {
            steps {
                echo 'Deploying to EC2 instance...'
                script {
                    sshagent(['ec2-ssh-key']) {
                        sh '''
                            ssh -o StrictHostKeyChecking=no ubuntu@23.20.92.144 "
                                cd /home/ubuntu/travel-bucket-list
                                echo 'Pulling latest images from Docker Hub...'
                                docker compose pull
                                echo 'Restarting containers...'
                                docker compose up -d --force-recreate
                                echo 'Deployment complete!'
                                docker ps
                            "
                        '''
                    }
                }
            }
        }
        
        stage('Health Check') {
            steps {
                echo 'Verifying deployment...'
                script {
                    sh '''
                        echo "Waiting 15 seconds for services to start..."
                        sleep 15
                        echo "Testing frontend..."
                        curl -f http://23.20.92.144:5173 || exit 1
                        echo "Testing backend..."
                        curl -f http://23.20.92.144:5000/api/health || echo "Backend health endpoint not found, checking root..."
                        curl -f http://23.20.92.144:5000 || exit 1
                        echo "âœ“ All services are healthy!"
                    '''
                }
            }
        }
    
    Update post section to include deployment cleanup:
        post {
        always {
            echo 'Cleaning up local Docker images...'
            sh """
                docker rmi ${DOCKER_HUB_REPO}-frontend:${IMAGE_TAG} || true
                docker rmi ${DOCKER_HUB_REPO}-backend:${IMAGE_TAG} || true
            """
        }
        success {
            echo 'âœ“ Pipeline completed successfully!'
            echo 'âœ“ Application deployed to: http://23.20.92.144:5173'
        }
        failure {
            echo 'âœ— Pipeline failed. Check the logs for details.'
        }
    }


ğŸ”§ Step 2: Update EC2 docker-compose.yml for Docker Hub
Connect to app server:

ssh -i ~/.ssh/travel-bucket-key.pem ubuntu@23.20.92.144

Edit docker-compose.yml:

cd /home/ubuntu/travel-bucket-list
nano docker-compose.yml

Replace the entire file with:

version: '3.8'

services:
  backend:
    image: yrcd27/travel-bucket-list-backend:latest
    container_name: travel-backend
    restart: always
    ports:
      - "5000:5000"
    environment:
      DB_HOST: travel-bucket-db.ck3k822u2a5v.us-east-1.rds.amazonaws.com
      DB_USER: admin
      DB_PASSWORD: TravelBucket2024SecurePass
      DB_NAME: travelbucket
      JWT_SECRET: your-super-secret-jwt-key-change-in-production
      PORT: 5000
      NODE_ENV: production
      CORS_ORIGIN: http://23.20.92.144:5173
    networks:
      - app-network

  frontend:
    image: yrcd27/travel-bucket-list-frontend:latest
    container_name: travel-frontend
    restart: always
    ports:
      - "5173:80"
    depends_on:
      - backend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

Save: Ctrl+O, Enter, Ctrl+X

Test pull:

docker compose pull
docker compose up -d
docker ps

ğŸ”§ Step 3: Configure GitHub Webhook
In your GitHub repository:

Go to Settings â†’ Webhooks â†’ Add webhook
Fill in:

Payload URL: http://34.202.19.207:8080/github-webhook/
Content type: application/json
Which events: Just the push event
Active: âœ“ (checked)

Click Add webhook
Verify: Green checkmark should appear (webhook delivered successfully)
If webhook fails:

Check Jenkins is accessible: curl http://34.202.19.207:8080
Check security group allows port 8080 from GitHub IPs
ğŸ”§ Step 4: Test Pipeline Manually First
In Jenkins UI:

Go to travel-bucket-list-pipeline
Click Build Now
Watch Console Output
Expected stages:
âœ“ Checkout
âœ“ Build Docker Images (parallel)
âœ“ Test (parallel)
âœ“ Push to Docker Hub
âœ“ Deploy to EC2
âœ“ Health Check
If build fails:

Docker login fails: Check dockerhub-credentials ID matches
SSH fails: Check ec2-ssh-key ID matches and private key is correct
Deployment fails: Check docker-compose.yml uses Docker Hub images
Health check fails: Increase sleep time or check app logs
ğŸ”§ Step 5: Test Complete CI/CD Flow
Make a code change:

cd f:/5_Sem_Projects/DevOps_Project/Personal-Travel-Bucket-List
# Edit any file (e.g., add comment to README.md)
echo "# CI/CD Pipeline Active" >> README.md
git add .
git commit -m "test: trigger CI/CD pipeline"
git push origin main

Watch Jenkins:

Pipeline should start automatically within 30 seconds
Monitor Console Output
Verify deployment completes
Check app at http://23.20.92.144:5173
ğŸ¯ Success Criteria Checklist
 Jenkinsfile has Deploy and Health Check stages
 EC2 docker-compose.yml uses Docker Hub images (image: not build:)
 GitHub webhook shows green checkmark
 Manual pipeline build completes successfully
 Git push triggers pipeline automatically
 Images build and push to Docker Hub
 Containers restart on EC2 with new images
 Health checks pass
 Application accessible at http://23.20.92.144:5173
ğŸš¨ Troubleshooting Guide
Pipeline Fails at "Push to Docker Hub"
# Check credential ID in Jenkins matches Jenkinsfile
# Verify Docker Hub token is valid
# Try manual login on Jenkins server:
ssh ubuntu@34.202.19.207
docker login -u yrcd27
# (enter password)

Pipeline Fails at "Deploy to EC2"
# Test SSH from Jenkins to App server:
ssh ubuntu@34.202.19.207
ssh -i ~/.ssh/id_rsa ubuntu@23.20.92.144
# If fails, check Jenkins has SSH key configured

Deployment Succeeds but App Not Working
# Check logs on app server:
ssh ubuntu@23.20.92.144
cd /home/ubuntu/travel-bucket-list
docker compose logs backend
docker compose logs frontend
docker ps

GitHub Webhook Not Triggering

# Check webhook delivery in GitHub:
# Settings â†’ Webhooks â†’ Recent Deliveries
# Look for 200 response
# If fails, check Jenkins URL is accessible from internet
curl http://34.202.19.207:8080

ğŸ“ Modified Files Summary
Jenkinsfile - Added Deploy to EC2 and Health Check stages
/home/ubuntu/travel-bucket-list/docker-compose.yml on EC2 - Changed from build: to image: for both services
ğŸ¬ Next Steps After This Point
Update Jenkinsfile with Deploy and Health Check stages (code provided above)
Update docker-compose.yml on EC2 to use Docker Hub images
Configure GitHub webhook with Jenkins URL
Test manually - Click "Build Now" in Jenkins
Test automatically - Push code to GitHub
Monitor and verify - Check all stages complete successfully
ğŸ’¾ Backup Commands
Save current state before changes:

# Backup docker-compose.yml
ssh ubuntu@23.20.92.144 'cp /home/ubuntu/travel-bucket-list/docker-compose.yml /home/ubuntu/docker-compose.yml.backup'

# Backup Jenkinsfile locally
cp Jenkinsfile Jenkinsfile.backup

Rollback if needed:
ssh ubuntu@23.20.92.144 'cp /home/ubuntu/docker-compose.yml.backup /home/ubuntu/travel-bucket-list/docker-compose.yml && cd /home/ubuntu/travel-bucket-list && docker compose up -d'
This plan is complete and self-contained. Any agent can pick up from here with all necessary information! ğŸš€